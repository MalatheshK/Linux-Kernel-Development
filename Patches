Introduction to Patches
You may wonder what a change to the kernel looks like. Changes to the kernel are normally called a "patch" after the name of the historical tool that works with incremental changes to a text file, likely originating in the patch used in stitching a quilt or mending a piece of clothing. ​In this chapter, we will break down the patch into components and discuss the purpose of each.

Learning Objectives
By the end of this chapter, you should be able to:

Understand git basics walking through the references.
Discuss different patch components.
Discuss patch commit logs.
Discuss tags.

===============================================================================================================================

About Patches
Linux kernel development is done using git, which was started by Linus Torvalds and is currently maintained by Junio C. Hamano. To learn more about git, read A Short History of Git and the Git Book for details on how to use git. The first three chapters of the Git Book provide the basics on how to get commit history, working with remotes, creating branches, tags, and rebasing to tagged versions. These are essential survival skills, necessary for any developer.

Developers email changes they want to see in the kernel to the kernel mailing lists. These changes are called patches. Patches are small incremental changes made to the kernel. Each patch contains a change to the kernel that implements one independent modification that stands on its own. A patch cannot break the kernel build. Requiring each patch to do one thing makes it easier to isolate regressions; reverting a problem patch also becomes easier. Complex changes to the kernel are thus split into smaller chunks.

For example, if you were to find an existing compile warning while making a code change, you would fix it independently in a separate patch instead of combining it with your code change.

Maintainers have their personal preferences on how granular the patch splitting should be for their subsystems. This is true for coding styles as well. Maintainers are good about giving feedback on their preferences during the patch review.​


What's in a Patch?
You can see a real commit below. We highlighted individual components in the screenshot, and we will walk through these individual components as well.

We used:

git format-patch -1 --pretty=fuller 3a38e874d70b

to generate the patch and get the complete information about this patch.
Patch Example

Select "Expand" to read about the components of a patch.

Patch Components

Close Commit ID
The auto-generated SHA-1 hash is generated from a cryptographic hash function with all the essential patch information, such as the commit date, the committer's name and email address, the log message, and more. Changing any of the information associated with the Commit ID results in changing it. This makes it a tamperproof, fast way to compare two commits using the IDs, and git pull requests become quick and efficient.

Close Commit header
major subsystem: minor area: short description of what is being changed

As you can see in the example provided, the patch changes the usbip_host driver, which is a sub-driver of the usbip driver. This driver falls under the drivers/usb subsystem. The author of the patch writes this information in a standard format with ":" separating the major and minor subsystem fields. You will also see "/" as a separator, which would look like usbip/usbip_host: cleanup do_rebind() return path instead of usbip: usbip_host: cleanup do_rebind() return path. Using "/" or ":" is determined by the maintainer's preference. If in doubt, refer to a few patches for the subsystem for information on individual preferences.

Close Commit log
It provides a detailed description of the change and why it is made. Alternate design choices, if any, are considered, as are details about the testing done. Our example shows a small change, and the commit log is simple and to the point. Commit logs can be long for patches that fix panics, as they include panic stack traces. We encourage you to take a look at a few commit logs in the kernel source repository to understand better the kind of relevant information to include in them.

Close Author
This component provides the author's name and email information. This information can be specified when you run git commit or it can be configured in your .gitconfig file, which is a very convenient way to generate commits. You can see an example of a .gitconfig file for author and email below. Please note that the email address in the Signed-off-by should match the address from which you send patches.

Email and Name Details

Close AuthorDate
Auto-generated commit time and date. This value comes from your computer's system time when you create the change.


Close Commit
The committer's name and email address. The committer is a maintainer or developer who applies the patch to a git repository. This patch was picked up by the USB maintainer Greg Kroah-Hartman, committed to the usb tree, and tested prior to being included in a pull request from Greg KH to Linus Torvalds. Since it was pulled, you won't see Linus as the committer for this patch. If you look at the git log, you will see several merge commits from Linus for when he pulls subsystem trees from maintainers.

Close CommitDate
The auto-generated commit time and date when Greg KH applied this patch to the usb tree. You will notice a difference of 19 days between the initial commit date and the commit date when the patch was applied to the usb tree. This is not unusual, depending on where things are in the release cycle. Merge windows and quiet periods could delay a patch from being applied.

Close Signed-off-by
Using sign-off, developers certify the patch to be their original work or have the right to pass it on as an open source patch. In our example, the author signed off and then, as the usb maintainer, Greg KH signed-off on the patch. Please refer to Sign your work - the Developer's Certificate of Origin for detailed information on this tag, as it is a very important part of the kernel development process.


More About Tags
Flip the cards to learn more about the different tags.

Acked-by :
This tag is often used by the maintainer of the affected code when that maintainer neither contributed to nor forwarded the patch. For example, Shuah maintains the usbip driver and she uses the Acked-by tag to ask the USB maintainer to pick patches sent by other developers.

Reviewd-by:
This tag indicates that the patch has been reviewed by the person named in the tag.

Reported-by:
This tag gives credit to people who find bugs and report them.

Tested-by :
This tag indicates that the patch has been tested by the person named in the tag.

Suggested- by:
This tag is used to give credit for the patch idea to the person named in the tag.

Fixes
This tag indicates that the patch fixes an issue in a previous commit referenced by its Commit ID. This tag allows us to track where the bug originated.


Please refer to Using Reported-by:, Tested-by:, Reviewed-by:, Suggested-by: and Fixes for more information on the above mentioned tags and the Reviewer's statement of oversight.

Patch Email Subject Line Conventions
Let's find out how to prefix patch email subject lines. The [PATCH] prefix is used to indicate that the email consists of a patch. [PATCH RFC] or [RFC PATCH] indicates the author is requesting comments on the patch. RFC stands for "Request For Comments". [PATCH v4] is used to indicate that the patch is the 4th version of this specific change that is being submitted. It is not unusual for a patch to go through a few revisions before it gets accepted. This is an artifact of collaborative development. The goal is to get the code right and not rush it in.

Patch Version History
Including the patch version history when sending a re-worked patch is required. The patch revision history on what changed between the current and the previous versions is added “---” and “start of the diff” in the patch file. Any text that is added here gets thrown away and will not be included in the commit when it is merged into the source tree. Including information that helps with reviews and doesn't add value to the commit log here is good practice. Please check mailing lists to get a feel for what information gets added here.

Do not send new patch versions as a reply to a previous version. Start a new thread for each version of a patch. An example description of what changed is: "Changes since v3: Added null check for <variable name> as suggested by <name>." You can see a patch example with version history for the v2 version.




